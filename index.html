
<html>
<script
  src="require.js"
></script>

<script type="text/javascript" src="https://js.taplytics.com/jssdk/ad5fec4fe0c14d7da75c959f4fa70cc5.min.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
  <script
    src="sum.js"
  ></script>

  <body ng-app="myApp" ng-controller="myCtrl">


  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Name</th>

      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="x in arrayer">
        <th scope="row">{{x.user_id}}</th>
        <td>{{x.name}}</td>

      </tr>

    </tbody>
  </table>
</body>



</html>
<script>
var array = [{"latitude": "52.986375", "user_id": 12, "name": "Christina McArdle", "longitude": "-6.043701"},
{"latitude": "51.92893", "user_id": 1, "name": "Alice Cahill", "longitude": "-10.27699"},
{"latitude": "51.8856167", "user_id": 2, "name": "Ian McArdle", "longitude": "-10.4240951"},
{"latitude": "52.3191841", "user_id": 3, "name": "Jack Enright", "longitude": "-8.5072391"},
{"latitude": "53.807778", "user_id": 28, "name": "Charlie Halligan", "longitude": "-7.714444"},
{"latitude": "53.4692815", "user_id": 7, "name": "Frank Kehoe", "longitude": "-9.436036"},
{"latitude": "54.0894797", "user_id": 8, "name": "Eoin Ahearn", "longitude": "-6.18671"},
{"latitude": "53.038056", "user_id": 26, "name": "Stephen McArdle", "longitude": "-7.653889"},
{"latitude": "54.1225", "user_id": 27, "name": "Enid Gallagher", "longitude": "-8.143333"},
{"latitude": "53.1229599", "user_id": 6, "name": "Theresa Enright", "longitude": "-6.2705202"},
{"latitude": "52.2559432", "user_id": 9, "name": "Jack Dempsey", "longitude": "-7.1048927"},
{"latitude": "52.240382", "user_id": 10, "name": "Georgina Gallagher", "longitude": "-6.972413"},
{"latitude": "53.2451022", "user_id": 4, "name": "Ian Kehoe", "longitude": "-6.238335"},
{"latitude": "53.1302756", "user_id": 5, "name": "Nora Dempsey", "longitude": "-6.2397222"},
{"latitude": "53.008769", "user_id": 11, "name": "Richard Finnegan", "longitude": "-6.1056711"},
{"latitude": "53.1489345", "user_id": 31, "name": "Alan Behan", "longitude": "-6.8422408"},
{"latitude": "53", "user_id": 13, "name": "Olive Ahearn", "longitude": "-7"},
{"latitude": "51.999447", "user_id": 14, "name": "Helen Cahill", "longitude": "-9.742744"},
{"latitude": "52.966", "user_id": 15, "name": "Michael Ahearn", "longitude": "-6.463"},
{"latitude": "52.366037", "user_id": 16, "name": "Ian Larkin", "longitude": "-8.179118"},
{"latitude": "54.180238", "user_id": 17, "name": "Patricia Cahill", "longitude": "-5.920898"},
{"latitude": "53.0033946", "user_id": 39, "name": "Lisa Ahearn", "longitude": "-6.3877505"},
{"latitude": "52.228056", "user_id": 18, "name": "Bob Larkin", "longitude": "-7.915833"},
{"latitude": "54.133333", "user_id": 24, "name": "Rose Enright", "longitude": "-6.433333"},
{"latitude": "55.033", "user_id": 19, "name": "Enid Cahill", "longitude": "-8.112"},
{"latitude": "53.521111", "user_id": 20, "name": "Enid Enright", "longitude": "-9.831111"},
{"latitude": "51.802", "user_id": 21, "name": "David Ahearn", "longitude": "-9.442"},
{"latitude": "54.374208", "user_id": 22, "name": "Charlie McArdle", "longitude": "-8.371639"},
{"latitude": "53.74452", "user_id": 29, "name": "Oliver Ahearn", "longitude": "-7.11167"},
{"latitude": "53.761389", "user_id": 30, "name": "Nick Enright", "longitude": "-7.2875"},
{"latitude": "54.080556", "user_id": 23, "name": "Eoin Gallagher", "longitude": "-6.361944"},
{"latitude": "52.833502", "user_id": 25, "name": "David Behan", "longitude": "-8.522366"}];
var array_people_less_100 = [];
var longitude = array[0].longitude ;
var latitude = array[0].latitude;
var dublinOffice_longitude= -6.257664;
var dublinOffice_latitude= 53.339428;
//earth radius
var R = 6371; // km

//convert from degrees to Rad 
function toRad(x) {
   return x * Math.PI / 180;
}


//loading array through AJAX

/*
var request = new XMLHttpRequest();
 request.open("GET", "https://api.myjson.com/bins/z774d", false);
 request.send(null);
 var array = request.responseText;
 alert(array); // Shows "15"
*/




/*$.getJSON("gistfile1.json", function(json) {
    var array = json; // to get the data directly from the json file but this approach needs a server or to allow chrome to load files using the command 'chrome --allow-file-access-from-files'
});
*/



// the calculate function uses the  haversine formula to calculate the distance between a client and the dublin office
// function takes the coordinates and applys the math using Math library
function calculate(){

  var x1 = latitude-dublinOffice_latitude;
  var dLat = toRad(x1);
  var x2 = longitude-dublinOffice_longitude;
  var dLon = toRad(x2);
  var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(toRad(dublinOffice_latitude)) * Math.cos(toRad(latitude)) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  var distance = R * c;
  if (distance <= 100) {
    console.log(distance);
    return distance;



  }
}
//This function sorts the array based on user ID in ascending orders
function sort( arrayx ){

    for (var i = 0; i < arrayx.length; i++)

      for (var j = arrayx.length-1 ;  j > i   ; j--) {

          //loop through the whole array while switching position if the value on the left is bigger than the right
        if (arrayx[j].user_id < arrayx[i].user_id) {
          var temp = arrayx[j];
          arrayx[j] =arrayx[i];
          arrayx[i]= temp;
        }
      }
      if(arrayx[0].user_id<arrayx[1].user_id)   //test to see if array is sorted
      return 0;

}
for (var i = 0; i < array.length; i++) {
   longitude = array[i].longitude ;
   latitude = array[i].latitude;

   var distance = calculate();
   if (i == 0) {


   }
   if(distance <=100){
     array_people_less_100.push(array[i]);


   }
}

sort(array_people_less_100);

//Using angularjs to easily display the clients and their id as a bootstrap table
var app = angular.module('myApp', []);
app.controller('myCtrl', function($scope) {
    $scope.arrayer = array_people_less_100;
});


</script>
